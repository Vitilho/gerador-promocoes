<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Postagens - Central do Vitilho</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h2>üõ† Dados da Promo√ß√£o</h2>
    
    <label>Produto</label>
    <input type="text" id="produto" placeholder="Ex: RTX 5060" oninput="update()" autofocus>
    
    <label>Coment√°rio Produto</label>
    <input type="text" id="comentarioProd" oninput="update()">
    
    <label>Cupom</label>
    <input type="text" id="cupom" oninput="update()">
    
    <label>Pre√ßo De (R$)</label>
    <input type="text" id="precoDe" placeholder="3.999,00" oninput="update()">
    
    <label>Pre√ßo Por (R$)</label>
    <input type="text" id="precoPor" placeholder="2.269,55" oninput="update()">
    
    <label>Quantidade de Parcelas (Sem Juros)</label>
    <input type="number" id="qtdParcelas" placeholder="Ex: 10" oninput="update()">

    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-top: 15px;">
        <input type="checkbox" id="freteGratis" onchange="update()" checked style="width: auto;"> Possui Frete Gr√°tis?
    </label>
    
    <label>Link</label>
    <input type="text" id="link" oninput="update()">
    
    <label>Loja/Vendedor</label>
    <div class="presets-container">
        <div class="section-title">Mercado Livre</div>
        <button class="btn-preset ml" onclick="setLoja('Loja Oficial, |')">Oficial</button>
        <button class="btn-preset ml" onclick="setLoja('Loja MercadoL√≠der Platinum')">Platinum</button>
        <button class="btn-preset ml" onclick="setLoja('Loja MercadoL√≠der Gold')">Gold</button>
        <button class="btn-preset ml" onclick="setLoja('Loja MercadoL√≠der')">L√≠der</button>

        <div class="section-title">Shopee</div>
        <button class="btn-preset shopee" onclick="setLoja('Loja Oficial, |')">Oficial</button>
        <button class="btn-preset shopee" onclick="setLoja('Indica√ß√£o Shopee')">Indica√ß√£o</button>

        <div class="section-title">Amazon</div>
        <button class="btn-preset amazon" onclick="setLoja('Vendido e Entregue pela Amazon')">Full Amazon</button>
        <button class="btn-preset amazon" onclick="setLoja('Vendido por | e Entregue pela Amazon')">Mkt + Entregue</button>
        <button class="btn-preset amazon" onclick="setLoja('Vendido e Entregue pela |')">Vendido + Entregue</button>
    </div>
    <input type="text" id="loja" oninput="update()" placeholder="Selecione acima ou digite...">

    <button class="btn-clear" onclick="clearFields()">Limpar Tudo</button>
</div>

<div class="preview-container">
    <h2>üì± Preview (Pronto para Copiar)</h2>
    <div id="result" class="output"></div>
    <button class="btn-copy" onclick="copyToClipboard()">Copiar Postagem</button>
</div>

<script>
    function formatarMoeda(valor) {
        if (!valor || isNaN(valor)) return "";
        return valor.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    // Fun√ß√£o Inteligente para preencher a loja e posicionar o cursor
    function setLoja(texto) {
        const inputLoja = document.getElementById('loja');
        
        // Verifica se o texto tem o caractere curinga "|"
        if (texto.includes('|')) {
            const partes = texto.split('|');
            inputLoja.value = partes.join(''); // Remove o pipe para o texto final
            update();
            inputLoja.focus();
            
            // Define a posi√ß√£o do cursor exatamente onde estava o "|"
            const posicaoCursor = partes[0].length;
            inputLoja.setSelectionRange(posicaoCursor, posicaoCursor);
        } else {
            inputLoja.value = texto;
            update();
        }
    }

    function update() {
        const getValRaw = (id) => {
            let val = document.getElementById(id).value;
            if (!val) return 0;
            let cleanVal = val.replace(/\./g, '').replace(',', '.');
            return parseFloat(cleanVal) || 0;
        };
        
        const p = (id) => document.getElementById(id).value;
        const temFrete = document.getElementById('freteGratis').checked;
        
        let numDe = getValRaw('precoDe');
        let numPor = getValRaw('precoPor');
        let qtdParc = parseInt(p('qtdParcelas'));
        let descCalculado = "";

        if (numDe > 0 && numPor > 0) {
            let calculo = Math.round(((numDe - numPor) / numDe) * 100);
            descCalculado = (calculo > 0) ? `-${calculo}%` : `0%`;
        }

        const precoDeFormatado = formatarMoeda(numDe);
        const precoPorFormatado = formatarMoeda(numPor);

        let postagem = `‚úÖ ${p('produto')}\n`;
        if(p('comentarioProd')) postagem += `> ${p('comentarioProd')}\n\n`;
        else postagem += `\n`;

        if(p('cupom')) postagem += `üè∑Ô∏è Cupom: *${p('cupom').toUpperCase()}*\n`;
        
        if(precoDeFormatado) {
            postagem += `üí∞ De: ~R$ ${precoDeFormatado}~\n`;
        }
        
        if(precoPorFormatado) {
            let tagDesc = descCalculado ? ` \`${descCalculado}\`` : "";
            postagem += `üî• Por: *R$ ${precoPorFormatado}*${tagDesc}\n`;
        }
        
        if(qtdParc > 1 && numPor > 0) {
            let valorParcela = numPor / qtdParc;
            postagem += `üí≥ Parcelamento: *${qtdParc}x de R$ ${formatarMoeda(valorParcela)} SEM JUROS*\n`;
        }
        
        if(temFrete) postagem += `üöö Frete Gr√°tis\n`;
        if(p('link')) postagem += `\nüîó ${p('link')}\n`;
        if(p('loja')) postagem += `> ${p('loja')}`;

        document.getElementById('result').innerText = postagem;
    }

    function copyToClipboard() {
        const text = document.getElementById('result').innerText;
        navigator.clipboard.writeText(text).then(() => {
            const btn = document.querySelector('.btn-copy');
            btn.innerText = "‚úÖ Copiado!";
            setTimeout(() => { btn.innerText = "Copiar Postagem"; }, 2000);
        });
    }

    function clearFields() {
        document.querySelectorAll('input').forEach(i => i.value = '');
        document.getElementById('freteGratis').checked = true;
        update();
        document.getElementById('produto').focus();
    }

    window.onload = () => {
        update();
        document.getElementById('produto').focus();
    };
</script>

</body>
</html>
